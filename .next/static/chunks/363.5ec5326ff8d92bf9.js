"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[363],{9784:function(e,E,_){_.d(E,{Z:function(){return T}});var t=_(5893),s=_(8119),l=_(7294),r=_(9417),n=_(2489),a=_(8375),c=e=>{let{files:E}=e;async function _(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"downloadedFile";try{let _=await fetch(e),t=await _.blob(),s=window.URL.createObjectURL(t),l=document.createElement("a");l.href=s,l.download=E,document.body.appendChild(l),l.click(),document.body.removeChild(l)}catch(e){console.error("Error downloading the file:",e)}}let s=e=>{let E=e.match(/([^/_]+)(?=_[^/]+$)/);return E?E[1]:"defaultName"};return(0,t.jsx)("div",{className:"mt-2 flex gap-2 bg-slate-200 p-2 rounded",children:null==E?void 0:E.map((e,E)=>["jpg","jpeg","png","gif","bmp","webp"].includes(e.type)?(0,t.jsx)("button",{onClick:()=>_(e.url,"imagen_".concat(E,".").concat(e.type)),children:(0,t.jsx)(a.bz,{src:e.url,width:500,height:500,alt:"File ".concat(E),className:"rounded shadow-md hover:scale-110 hover:shadow-lg transition-all"})},E):["mp4","mpeg","ogv","webm","3gp","3g2"].includes(e.type)?(0,t.jsx)("video",{src:e.url,controls:!0,className:"rounded shadow-md"},E):"pdf"===e.type?(0,t.jsx)("iframe",{src:e.url,width:"500",height:"500",className:"rounded shadow-md",title:"PDF File ".concat(E)},E):(0,t.jsx)("div",{className:"flex flex-col items-center bg-white w-fit rounded shadow-md hover:scale-110 hover:shadow-lg transition-all",children:(0,t.jsxs)("button",{onClick:()=>_(e.url,"".concat(s(e.url),".").concat(e.type)),children:[(0,t.jsx)("p",{className:"text-sm px-2",children:s(e.url)}),(0,t.jsx)("p",{className:"text-black p-1 text-center uppercase",children:e.type}),(0,t.jsx)(n.G,{icon:r.q7m,size:"xs"})]})},E))})},R=e=>{let{messages:E,chatBoxVariant:_="videochat",hasNextPage:s,fetchNextPage:r}=e,n=(0,l.useRef)(null),a=(0,l.useRef)(E.length);return(0,l.useEffect)(()=>{n.current&&E.length>a.current&&(n.current.scrollTop=n.current.scrollHeight),a.current=E.length},[E]),(0,t.jsx)("div",{className:"".concat("videochat"===_?"h-52":"h-[30rem] "," overflow-y-auto"),ref:n,children:(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center px-2",children:[s&&(0,t.jsx)("button",{onClick:()=>r(),className:"my-2 py-2 px-4 bg-blue-500 text-white rounded hover:bg-blue-600 focus:outline-none",children:"Cargar mensajes anteriores"}),E&&E.map((e,E)=>{let _=e.files&&e.files.length>0;return(0,t.jsxs)("div",{className:"bg-white w-full",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsxs)("strong",{className:"text-blue-500 mr-2",children:[e.user,":"]}),(0,t.jsx)("p",{children:e.message})]}),_&&(0,t.jsx)(c,{files:e.files})]},E)})]})})};let o={jpeg:"jpg",png:"png",gif:"gif",bmp:"bmp",webp:"webp","svg+xml":"svg",plain:"txt",csv:"csv",html:"html",css:"css",javascript:"js",json:"json",pdf:"pdf",mp4:"mp4",mpeg:"mpeg",ogg:"ogv",webm:"webm","3gpp":"3gp","3gpp2":"3g2","vnd.openxmlformats-officedocument.wordprocessingml.document":"docx","vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx","vnd.openxmlformats-officedocument.presentationml.presentation":"pptx","vnd.ms-word":"doc","vnd.ms-excel":"xls","vnd.ms-powerpoint":"ppt","vnd.ms-cab-compressed":"cab",rar:"rar","x-7z-compressed":"7z",zip:"zip"};var N=_(5675),i=_.n(N),I=e=>{let{previews:E}=e,_=e=>{let E=e.match(/data:([^;]+);/);if(E&&E[1]){let e=E[1],_=e.split("/"),t=_.length>1?_[1]:"";return o[t]||t}return""};return(0,t.jsx)("div",{className:"flex flex-wrap",children:E.map((e,E)=>{let s=_(e);return["jpg","jpeg","png","gif","bmp","webp"].includes(s)?(0,t.jsx)(i(),{src:e,width:112,height:112,alt:"Preview",className:"m-2 rounded shadow"},E):["mp4","webm","ogg"].includes(s)?(0,t.jsx)("video",{src:e,controls:!0,className:"m-2 w-32 h-32 object-cover rounded shadow"},E):(0,t.jsx)("div",{className:"m-2 w-28 h-28 flex items-center justify-center bg-gray-200 rounded shadow",children:(0,t.jsx)("span",{className:"text-gray-600",children:s})},E)})})},T=()=>{let e=(0,l.useContext)(s.SocketContext);if(!e)throw Error("You must use this component within a <ContextProvider>");let{messages:E,message:_,sendMessage:a,setMessage:c,handleUploadImages:o,previews:N,submitBtnDisabled:i,chatBoxVariant:T,fetchNextPage:d,hasNextPage:A}=e;return(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)(R,{chatBoxVariant:T,messages:E,hasNextPage:A,fetchNextPage:d}),(0,t.jsx)("div",{className:"",children:N&&(0,t.jsx)(I,{previews:N})}),(0,t.jsxs)("form",{className:"flex items-center w-full justify-center",children:[(0,t.jsx)("input",{type:"text",value:_,onChange:e=>c(e.target.value),placeholder:"Escribe un mensaje...",className:"flex-grow p-2 border rounded-md focus:outline-none focus:border-blue-500"}),(0,t.jsx)("label",{htmlFor:"file",className:"px-2 flex justify-center items-center ml-2 w-8 h-8 cursor-pointer rounded-full hover:bg-slate-400 transition-all ",children:(0,t.jsx)(n.G,{icon:r.Alc,size:"lg"})}),(0,t.jsx)("input",{name:"file",accept:"*",className:"",type:"file",id:"file",multiple:!0,onChange:o,hidden:!0}),(0,t.jsx)("button",{onClick:e=>{e.preventDefault(),a()},type:"submit",disabled:i,className:"ml-2 py-2 px-4 bg-green-500 text-white rounded hover:bg-green-600 focus:outline-none",children:i?"Cargando...":"Enviar"})]})]})}},363:function(e,E,_){_.r(E),_.d(E,{default:function(){return u}});var t,s,l,r,n,a=_(5893),c=_(7294),R=_(8424),o=_.n(R);(t=n||(n={})).UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE";var N=_(1163),i=_(8119),I=_(9784),T=_(2489),d=_(9417);let A={mode:"rtc",codec:"vp8",appid:"c2a17faedf124435a895dab019e37429"},O=(l=function(){try{return Promise.resolve(o().createMicrophoneAndCameraTracks(void 0,void 0)).then(function(e){return r=e})}catch(e){return Promise.reject(e)}},r=null,function(){var e=(0,c.useState)(!1),E=e[0],_=e[1],t=(0,c.useState)(null),s=t[0],n=t[1],a=(0,c.useRef)(r);return(0,c.useEffect)(function(){return null===a.current?l().then(function(e){a.current=e,_(!0)},function(e){n(e)}):_(!0),function(){r=null}},[]),{ready:E,tracks:a.current,error:s}});var u=()=>{let e=(0,N.useRouter)(),{id:E}=e.query,[_,t]=(0,c.useState)(!1),[l,r]=(0,c.useState)([]),[n,R]=(0,c.useState)(!1),u=(s||(s=o().createClient(A)),s),{ready:S,tracks:m}=O(),L=(0,c.useRef)(null),D=(0,c.useContext)(i.SocketContext);if(!D)throw Error("You must use this component within a <ContextProvider>");let{usersInRoom:p,setRoomName:C,roomName:h,duration:f}=D;return(0,c.useEffect)(()=>{C(E),S&&m&&!n&&u.join(A.appid,E,null).then(e=>{u.publish(m),t(!0),R(!0)})},[u,m,S,n,E]),(0,c.useEffect)(()=>{if(m&&L.current)return m[1].play(L.current),()=>{m[1].stop(),m[1].close()}},[m]),(0,c.useEffect)(()=>{let e=async(e,E)=>{await u.subscribe(e,E),"video"===E&&e.videoTrack&&(r(E=>[...E,e]),e.videoTrack.play("video-".concat(e.uid))),"audio"===E&&e.audioTrack&&e.audioTrack.play()},E=e=>{r(E=>E.filter(E=>E.uid!==e.uid))};return u.on("user-published",e),u.on("user-unpublished",E),()=>{u.off("user-published",e),u.off("user-unpublished",E)}},[u]),(0,c.useEffect)(()=>{let e=()=>{R(!1)};return u.on("disconnected",e),()=>{u.off("disconnected",e)}},[u]),(0,c.useEffect)(()=>{l.forEach(e=>{e.videoTrack&&e.videoTrack.play("video-".concat(e.uid))})},[l]),(0,c.useEffect)(()=>{let E=setTimeout(()=>{alert("llamada finalizada, duraci\xf3n: ".concat(f)),e.push("/")},f);return()=>{clearTimeout(E),m&&u.unpublish(m),u.leave().catch(e=>{console.error("Failed to leave the call",e)}),m&&m.forEach(e=>{e.stop(),e.close()}),u.removeAllListeners()}},[]),(0,a.jsxs)("div",{className:"w-full min-h-[95vh] grid grid-rows-3 grid-cols-5 gap-2 relative",children:[(0,a.jsx)("div",{className:"bg-slate-300 h-full col-span-5 row-span-2 flex justify-center gap-1",children:l.map(e=>(0,a.jsx)("div",{id:"video-".concat(e.uid),className:"h-full w-2/3 md:w-96 rounded-md"},e.uid))}),(0,a.jsx)("div",{className:"col-span-5 sm:col-span-4 flex mb-2",children:(0,a.jsxs)("div",{className:"w-full h-full p-2 rounded-md flex flex-col justify-between ",children:[(0,a.jsxs)("div",{className:"rounded p-2 sticky top-0 bg-slate-200 flex gap-2 z-20 justify-between text-xs sm:text-base",children:[(0,a.jsx)("div",{className:"hidden  md:flex gap-2",children:p.map((e,E)=>{let{name:_}=e;return(0,a.jsx)("div",{className:"",children:(0,a.jsx)("strong",{className:"text-blue-500",children:_})},E)})}),(0,a.jsx)("div",{children:h&&(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsxs)("p",{children:["Comparte este link:"," ","".concat("http://localhost:3000","/videocall/").concat(h)]}),(0,a.jsx)("button",{className:"ml-2",onClick:e=>{e.preventDefault(),navigator.clipboard.writeText("".concat("http://localhost:3000","/videocall/").concat(h))},children:(0,a.jsx)(T.G,{icon:d.kZ_,className:"text-slate-500"})})]})})]}),(0,a.jsx)(I.Z,{})]})}),(0,a.jsx)("div",{className:"w-24 h-24 row-start-1 col-start-5 absolute right-0 top-0 sm:w-full sm:h-full sm:static sm:row-start-3",children:(0,a.jsx)("div",{ref:L,className:"w-full h-full"})})]})}}}]);