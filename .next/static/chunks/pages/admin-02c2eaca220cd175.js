(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964],{577:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return t(8142)}])},8142:function(e,s,t){"use strict";t.r(s),t.d(s,{__N_SSP:function(){return p},default:function(){return h}});var a=t(5893),r=t(6492);let i=async()=>{let e=await fetch("/api/user_agent_info",{method:"GET"});return await e.json()};function d(e,s){let t={};e.forEach(e=>{let a=String(e[s]);t[a]?t[a]++:t[a]=1});let a="",r=-1;for(let e in t)t[e]>r&&(r=t[e],a=e);return isNaN(Number(a))?a:Number(a)}let n=e=>{let s=e.reduce((e,s)=>e+s.visits.length,0),t={},a={};e.forEach(e=>{e.visits.forEach(e=>{t[e.entry_point]?t[e.entry_point]++:t[e.entry_point]=1,a[e.os.name]?a[e.os.name]++:a[e.os.name]=1})});let r=Object.entries(t).sort((e,s)=>s[1]-e[1]),i=Object.entries(a).sort((e,s)=>s[1]-e[1]),d=r.length>3?r.slice(0,3):r,n=i.length>3?i.slice(0,3):i,l=new Set(e.map(e=>e._id)),c=l.size,x=c/s*100;return{totalVisits:s,topThreeEntryPoints:d,topThreeOS:n,newUsersPercentage:x,returningUsersPercentage:100-x}};t(7294);var l=e=>{let{data:s,users:t}=e,{totalVisits:r,topThreeEntryPoints:i,newUsersPercentage:d,returningUsersPercentage:l,topThreeOS:c}=n(s);return(0,a.jsx)("table",{className:"min-w-full bg-white divide-y divide-gray-200 shadow-sm rounded-lg overflow-hidden",children:(0,a.jsxs)("tbody",{className:"bg-white divide-y divide-gray-200",children:[(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 bg-gray-50 py-4 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Visitas totales"}),(0,a.jsx)("td",{className:"px-6 py-4 ",children:r})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 bg-gray-50 py-4 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Dispositivos registrados"}),(0,a.jsx)("td",{className:"px-6 py-4 ",children:s.length})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 bg-gray-50 py-4 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"% Usuarios registrados"}),(0,a.jsxs)("td",{className:"px-6 py-4 ",children:[(100*t.length/s.length).toFixed(2),"%"]})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 bg-gray-50 py-4 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Top 3 puntos de entrada"}),(0,a.jsx)("td",{className:"px-6 py-4",children:i.map(e=>{let[s,t]=e;return(0,a.jsxs)("div",{children:[s," ",(0,a.jsxs)("span",{className:"font-semibold",children:["(",t,")"]})]},s)})})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 bg-gray-50 py-4 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"% Usuarios nuevos"}),(0,a.jsxs)("td",{className:"px-6 py-4",children:[d.toFixed(2),"%"]})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 bg-gray-50 py-4 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"% Usuarios recurrentes"}),(0,a.jsxs)("td",{className:"px-6 py-4",children:[l.toFixed(2),"%"]})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 bg-gray-50 py-4 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Top 3 sistemas operativos"}),(0,a.jsx)("td",{className:"px-6 py-4",children:c.map(e=>{let[s,t]=e;return(0,a.jsxs)("div",{children:[s||"Bot"," ",(0,a.jsxs)("span",{className:"font-semibold",children:["(",t,")"]})]},s)})})]})]})})},c=e=>{let{data:s,users:t}=e,r={};return t.forEach(e=>{e.user_agent_id.forEach(s=>{r[s]=e.email})}),(0,a.jsxs)("table",{className:"min-w-full bg-white divide-y divide-gray-200 shadow-sm rounded-lg overflow-hidden mb-6",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Email / ID"}),(0,a.jsx)("th",{className:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Visitas"}),(0,a.jsx)("th",{className:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Punto de entrada preferido"}),(0,a.jsx)("th",{className:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"OS Preferido"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:s.sort((e,s)=>s.visits.length-e.visits.length).map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:r[e._id]||e._id}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.visits.length}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:d(e.visits,"entry_point")}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:d(e.visits.map(e=>e.os),"name")})]},e._id))})]})},x=e=>{let{data:s}=e,t=0,r={},i={},d={};return s.forEach(e=>{e.visits.forEach(e=>{e.utm_params&&(t++,e.utm_params.utm_source&&(r[e.utm_params.utm_source]=(r[e.utm_params.utm_source]||0)+1),e.utm_params.utm_medium&&(i[e.utm_params.utm_medium]=(i[e.utm_params.utm_medium]||0)+1),e.utm_params.utm_campaign&&(d[e.utm_params.utm_campaign]=(d[e.utm_params.utm_campaign]||0)+1))})}),(0,a.jsxs)("table",{className:"min-w-full bg-white divide-y divide-gray-200 shadow-sm rounded-lg overflow-hidden mb-6",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Parameter"}),(0,a.jsx)("th",{className:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Breakdown"})]})}),(0,a.jsxs)("tbody",{className:"bg-white divide-y divide-gray-200",children:[(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4",children:"Total de visitas con par\xe1metros UTM"}),(0,a.jsx)("td",{className:"px-6 py-4",children:t})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4",children:"Source"}),(0,a.jsx)("td",{className:"px-6 py-4",children:Object.entries(r).map(e=>{let[s,t]=e;return(0,a.jsxs)("div",{className:"capitalize",children:[s,": ",(0,a.jsx)("span",{className:"font-semibold",children:t})]},s)})})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4",children:"Medium"}),(0,a.jsx)("td",{className:"px-6 py-4",children:Object.entries(i).map(e=>{let[s,t]=e;return(0,a.jsxs)("div",{className:"capitalize",children:[s,": ",(0,a.jsx)("span",{className:"font-semibold",children:t})]},s)})})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4",children:"Campaign"}),(0,a.jsx)("td",{className:"px-6 py-4",children:Object.entries(d).map(e=>{let[s,t]=e;return(0,a.jsxs)("div",{children:[s,": ",(0,a.jsx)("span",{className:"font-semibold",children:t})]},s)})})]})]})]})},m=e=>{let{visits:s}=e,t=Array.from({length:7},(e,s)=>{let t=new Date;return t.setDate(t.getDate()-s),t.toISOString().slice(0,10)}).reverse(),r=t.map(e=>s.filter(s=>s.timestamp.startsWith(e)).length);return(0,a.jsxs)("table",{className:"min-w-full bg-white divide-y divide-gray-200 shadow-sm rounded-lg overflow-hidden mb-6",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Fecha"}),(0,a.jsx)("th",{className:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase",children:"Visitas"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map((e,s)=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:r[s]})]},e))})]})},p=!0,h=e=>{let{name:s,email:t}=e,{data:d,isLoading:n,error:p}=(0,r.a)(["user_agent_data"],i);if(n)return(0,a.jsx)("p",{children:"Cargando datos..."});if(p)return(0,a.jsxs)("p",{children:["Error. ",JSON.stringify(p)]});let h=d.userAgentData.flatMap(e=>e.visits);return(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"mb-6 p-4",children:["Logueado como ",s," (",t,")"]}),(0,a.jsx)("div",{className:"mb-12",children:(0,a.jsx)(l,{data:d.userAgentData,users:d.users})}),(0,a.jsx)("div",{className:"mb-12",children:(0,a.jsx)(c,{data:d.userAgentData,users:d.users})}),(0,a.jsx)("div",{className:"mb-12",children:(0,a.jsx)(x,{data:d.userAgentData})}),(0,a.jsx)("div",{className:"mb-12",children:(0,a.jsx)(m,{visits:h})})]})}},6492:function(e,s,t){"use strict";t.d(s,{a:function(){return d}});var a=t(2161),r=t(2924),i=t(7187);function d(e,s,t){let d=(0,a._v)(e,s,t);return(0,i.r)(d,r.z)}}},function(e){e.O(0,[828,774,888,179],function(){return e(e.s=577)}),_N_E=e.O()}]);