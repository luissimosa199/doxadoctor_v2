(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[934],{7189:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat/[id]",function(){return r(9923)}])},5677:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{noSSR:function(){return o},default:function(){return a}});let s=r(8754),n=(r(7294),s._(r(8976)));function l(e){return{default:(null==e?void 0:e.default)||e}}function o(e,t){return delete t.webpack,delete t.modules,e(t)}function a(e,t){let r=n.default,s={loading:e=>{let{error:t,isLoading:r,pastDelay:s}=e;return null}};e instanceof Promise?s.loader=()=>e:"function"==typeof e?s.loader=e:"object"==typeof e&&(s={...s,...e}),s={...s,...t};let a=s.loader;return(s.loadableGenerated&&(s={...s,...s.loadableGenerated},delete s.loadableGenerated),"boolean"!=typeof s.ssr||s.ssr)?r({...s,loader:()=>null!=a?a().then(l):Promise.resolve(l(()=>null))}):(delete s.webpack,delete s.modules,o(r,s))}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},2254:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"LoadableContext",{enumerable:!0,get:function(){return l}});let s=r(8754),n=s._(r(7294)),l=n.default.createContext(null)},8976:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return p}});let s=r(8754),n=s._(r(7294)),l=r(2254),o=[],a=[],i=!1;function c(e){let t=e(),r={loading:!0,loaded:null,error:null};return r.promise=t.then(e=>(r.loading=!1,r.loaded=e,e)).catch(e=>{throw r.loading=!1,r.error=e,e}),r}class u{promise(){return this._res.promise}retry(){this._clearTimeouts(),this._res=this._loadFn(this._opts.loader),this._state={pastDelay:!1,timedOut:!1};let{_res:e,_opts:t}=this;e.loading&&("number"==typeof t.delay&&(0===t.delay?this._state.pastDelay=!0:this._delay=setTimeout(()=>{this._update({pastDelay:!0})},t.delay)),"number"==typeof t.timeout&&(this._timeout=setTimeout(()=>{this._update({timedOut:!0})},t.timeout))),this._res.promise.then(()=>{this._update({}),this._clearTimeouts()}).catch(e=>{this._update({}),this._clearTimeouts()}),this._update({})}_update(e){this._state={...this._state,error:this._res.error,loaded:this._res.loaded,loading:this._res.loading,...e},this._callbacks.forEach(e=>e())}_clearTimeouts(){clearTimeout(this._delay),clearTimeout(this._timeout)}getCurrentValue(){return this._state}subscribe(e){return this._callbacks.add(e),()=>{this._callbacks.delete(e)}}constructor(e,t){this._loadFn=e,this._opts=t,this._callbacks=new Set,this._delay=null,this._timeout=null,this.retry()}}function d(e){return function(e,t){let r=Object.assign({loader:null,loading:null,delay:200,timeout:null,webpack:null,modules:null},t),s=null;function o(){if(!s){let t=new u(e,r);s={getCurrentValue:t.getCurrentValue.bind(t),subscribe:t.subscribe.bind(t),retry:t.retry.bind(t),promise:t.promise.bind(t)}}return s.promise()}if(!i){let e=r.webpack?r.webpack():r.modules;e&&a.push(t=>{for(let r of e)if(t.includes(r))return o()})}function c(e,t){!function(){o();let e=n.default.useContext(l.LoadableContext);e&&Array.isArray(r.modules)&&r.modules.forEach(t=>{e(t)})}();let a=n.default.useSyncExternalStore(s.subscribe,s.getCurrentValue,s.getCurrentValue);return n.default.useImperativeHandle(t,()=>({retry:s.retry}),[]),n.default.useMemo(()=>{var t;return a.loading||a.error?n.default.createElement(r.loading,{isLoading:a.loading,pastDelay:a.pastDelay,timedOut:a.timedOut,error:a.error,retry:s.retry}):a.loaded?n.default.createElement((t=a.loaded)&&t.default?t.default:t,e):null},[e,a])}return c.preload=()=>o(),c.displayName="LoadableComponent",n.default.forwardRef(c)}(c,e)}function m(e,t){let r=[];for(;e.length;){let s=e.pop();r.push(s(t))}return Promise.all(r).then(()=>{if(e.length)return m(e,t)})}d.preloadAll=()=>new Promise((e,t)=>{m(o).then(e,t)}),d.preloadReady=e=>(void 0===e&&(e=[]),new Promise(t=>{let r=()=>(i=!0,t());m(a,e).then(r,r)})),window.__NEXT_PRELOADREADY=d.preloadReady;let p=d},2345:function(e,t,r){"use strict";var s=r(5893),n=r(2489),l=r(3024),o=r(7294),a=r(9417);t.Z=e=>{let{url:t,title:r}=e,[i,c]=(0,o.useState)(!1),u=encodeURIComponent(t),d=encodeURIComponent(r),m=[{platform:"WhatsApp",url:"https://wa.me/?text=".concat(u+"?utm_source=w","%20").concat(d),icon:l.VHX,color:"#25D366"},{platform:"Facebook",url:"https://www.facebook.com/sharer/sharer.php?u=".concat(u+"?utm_source=f"),icon:l.neY,color:"#3b5998"},{platform:"Twitter",url:"https://twitter.com/share?url=".concat(u+"?utm_source=tw","&text=").concat(d),icon:l.mdU,color:"#1DA1F2"},{platform:"LinkedIn",url:"https://www.linkedin.com/sharing/share-offsite/?url=".concat(u+"?utm_source=l"),icon:l.D9H,color:"#0077b5"},{platform:"Pinterest",url:"https://pinterest.com/pin/create/button/?url=".concat(u+"?utm_source=p","&media=&description=").concat(d),icon:l.Xs4,color:"#BD081C"},{platform:"Reddit",url:"https://reddit.com/submit?url=".concat(u+"?utm_source=r","&title=").concat(d),icon:l.HK3,color:"#FF5700"},{platform:"Telegram",url:"https://telegram.me/share/url?url=".concat(u+"?utm_source=t","&text=").concat(d),icon:l.Uv8,color:"#0088cc"},{platform:"Email",url:"mailto:?subject=".concat(d,"&body=").concat(u+"?utm_source=e"),icon:l.Uv8,color:"#D44638"}];return(0,s.jsxs)("ul",{className:"flex gap-2 px-2 justify-center",children:[m.map((e,t)=>(0,s.jsx)("li",{className:"w-5 h-5",children:(0,s.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",children:(0,s.jsx)(n.G,{icon:e.icon,style:{color:e.color}})})},t)),(0,s.jsxs)("div",{children:[(0,s.jsx)("button",{type:"button",className:"w-5",onClick:()=>{navigator.clipboard.writeText(t+"?utm_source=cp"),c(!0),setTimeout(()=>{c(!1)},1e3)},children:(0,s.jsx)(n.G,{icon:a.kZ_,className:"text-slate-500"})}),i&&(0,s.jsx)("span",{className:"ml-2 text-xs",children:"Copiado!"})]})]})}},9784:function(e,t,r){"use strict";r.d(t,{Z:function(){return f}});var s=r(5893),n=r(8119),l=r(7294),o=r(9417),a=r(2489),i=r(8375),c=e=>{let{files:t}=e;async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"downloadedFile";try{let r=await fetch(e),s=await r.blob(),n=window.URL.createObjectURL(s),l=document.createElement("a");l.href=n,l.download=t,document.body.appendChild(l),l.click(),document.body.removeChild(l)}catch(e){console.error("Error downloading the file:",e)}}let n=e=>{let t=e.match(/([^/_]+)(?=_[^/]+$)/);return t?t[1]:"defaultName"};return(0,s.jsx)("div",{className:"mt-2 flex gap-2 bg-slate-200 p-2 rounded",children:null==t?void 0:t.map((e,t)=>["jpg","jpeg","png","gif","bmp","webp"].includes(e.type)?(0,s.jsx)("button",{onClick:()=>r(e.url,"imagen_".concat(t,".").concat(e.type)),children:(0,s.jsx)(i.bz,{src:e.url,width:500,height:500,alt:"File ".concat(t),className:"rounded shadow-md hover:scale-110 hover:shadow-lg transition-all"})},t):["mp4","mpeg","ogv","webm","3gp","3g2"].includes(e.type)?(0,s.jsx)("video",{src:e.url,controls:!0,className:"rounded shadow-md"},t):"pdf"===e.type?(0,s.jsx)("iframe",{src:e.url,width:"500",height:"500",className:"rounded shadow-md",title:"PDF File ".concat(t)},t):(0,s.jsx)("div",{className:"flex flex-col items-center bg-white w-fit rounded shadow-md hover:scale-110 hover:shadow-lg transition-all",children:(0,s.jsxs)("button",{onClick:()=>r(e.url,"".concat(n(e.url),".").concat(e.type)),children:[(0,s.jsx)("p",{className:"text-sm px-2",children:n(e.url)}),(0,s.jsx)("p",{className:"text-black p-1 text-center uppercase",children:e.type}),(0,s.jsx)(a.G,{icon:o.q7m,size:"xs"})]})},t))})},u=e=>{let{messages:t,chatBoxVariant:r="videochat",hasNextPage:n,fetchNextPage:o}=e,a=(0,l.useRef)(null),i=(0,l.useRef)(t.length);return(0,l.useEffect)(()=>{a.current&&t.length>i.current&&(a.current.scrollTop=a.current.scrollHeight),i.current=t.length},[t]),(0,s.jsx)("div",{className:"".concat("videochat"===r?"h-52":"h-[30rem] "," overflow-y-auto"),ref:a,children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center px-2",children:[n&&(0,s.jsx)("button",{onClick:()=>o(),className:"my-2 py-2 px-4 bg-blue-500 text-white rounded hover:bg-blue-600 focus:outline-none",children:"Cargar mensajes anteriores"}),t&&t.map((e,t)=>{let r=e.files&&e.files.length>0;return(0,s.jsxs)("div",{className:"bg-white w-full",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("strong",{className:"text-blue-500 mr-2",children:[e.user,":"]}),(0,s.jsx)("p",{children:e.message})]}),r&&(0,s.jsx)(c,{files:e.files})]},t)})]})})};let d={jpeg:"jpg",png:"png",gif:"gif",bmp:"bmp",webp:"webp","svg+xml":"svg",plain:"txt",csv:"csv",html:"html",css:"css",javascript:"js",json:"json",pdf:"pdf",mp4:"mp4",mpeg:"mpeg",ogg:"ogv",webm:"webm","3gpp":"3gp","3gpp2":"3g2","vnd.openxmlformats-officedocument.wordprocessingml.document":"docx","vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx","vnd.openxmlformats-officedocument.presentationml.presentation":"pptx","vnd.ms-word":"doc","vnd.ms-excel":"xls","vnd.ms-powerpoint":"ppt","vnd.ms-cab-compressed":"cab",rar:"rar","x-7z-compressed":"7z",zip:"zip"};var m=r(5675),p=r.n(m),h=e=>{let{previews:t}=e,r=e=>{let t=e.match(/data:([^;]+);/);if(t&&t[1]){let e=t[1],r=e.split("/"),s=r.length>1?r[1]:"";return d[s]||s}return""};return(0,s.jsx)("div",{className:"flex flex-wrap",children:t.map((e,t)=>{let n=r(e);return["jpg","jpeg","png","gif","bmp","webp"].includes(n)?(0,s.jsx)(p(),{src:e,width:112,height:112,alt:"Preview",className:"m-2 rounded shadow"},t):["mp4","webm","ogg"].includes(n)?(0,s.jsx)("video",{src:e,controls:!0,className:"m-2 w-32 h-32 object-cover rounded shadow"},t):(0,s.jsx)("div",{className:"m-2 w-28 h-28 flex items-center justify-center bg-gray-200 rounded shadow",children:(0,s.jsx)("span",{className:"text-gray-600",children:n})},t)})})},f=()=>{let e=(0,l.useContext)(n.SocketContext);if(!e)throw Error("You must use this component within a <ContextProvider>");let{messages:t,message:r,sendMessage:i,setMessage:c,handleUploadImages:d,previews:m,submitBtnDisabled:p,chatBoxVariant:f,fetchNextPage:g,hasNextPage:b}=e;return(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)(u,{chatBoxVariant:f,messages:t,hasNextPage:b,fetchNextPage:g}),(0,s.jsx)("div",{className:"",children:m&&(0,s.jsx)(h,{previews:m})}),(0,s.jsxs)("form",{className:"flex items-center w-full justify-center",children:[(0,s.jsx)("input",{type:"text",value:r,onChange:e=>c(e.target.value),placeholder:"Escribe un mensaje...",className:"flex-grow p-2 border rounded-md focus:outline-none focus:border-blue-500"}),(0,s.jsx)("label",{htmlFor:"file",className:"px-2 flex justify-center items-center ml-2 w-8 h-8 cursor-pointer rounded-full hover:bg-slate-400 transition-all ",children:(0,s.jsx)(a.G,{icon:o.Alc,size:"lg"})}),(0,s.jsx)("input",{name:"file",accept:"*",className:"",type:"file",id:"file",multiple:!0,onChange:d,hidden:!0}),(0,s.jsx)("button",{onClick:e=>{e.preventDefault(),i()},type:"submit",disabled:p,className:"ml-2 py-2 px-4 bg-green-500 text-white rounded hover:bg-green-600 focus:outline-none",children:p?"Cargando...":"Enviar"})]})]})}},9923:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return w}});var s=r(5893),n=r(7294),l=r(9784),o=r(8119),a=r(2345),i=r(1664),c=r.n(i),u=r(7041),d=r(6492),m=r(5945),p=(e,t)=>{let r=(0,m.NL)(),s=function(e){let t="=".repeat((4-e.length%4)%4),r=(e+t).replace(/\-/g,"+").replace(/_/g,"/"),s=atob(r),n=new Uint8Array(s.length);for(let e=0;e<s.length;++e)n[e]=s.charCodeAt(e);return n}("BOINoNDgymZI_-mV3-vB71q1-zvi-rTe8GezByLUdZ4DHpVcQNaHKdiqxGJ7XLeCr39lbc9yzNYMa2lUzNWpVos");(0,n.useEffect)(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register(e).then(e=>{}).catch(e=>{console.error("Service Worker registration failed:",e)})},[e]);let l=(0,n.useCallback)(async()=>{try{let e=await Notification.requestPermission();if("granted"===e&&"serviceWorker"in navigator){let e=await navigator.serviceWorker.ready,n=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:s}),l=await fetch("/api/chatSubscription",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:n,conversationId:t,user_agent_id:(0,u.getCookie)("user_agent_id")})}),o=await l.json();o.success?(r.invalidateQueries(["subscriptionStatus",(0,u.getCookie)("user_agent_id"),t]),console.log("Successfully subscribed!")):console.error("Error subscribing:",o.error)}}catch(e){console.error("Push subscription failed:",e)}},[s,t,r]),o=(0,n.useCallback)(async()=>{try{if("serviceWorker"in navigator){let e=await navigator.serviceWorker.ready,s=await e.pushManager.getSubscription();if(s){await s.unsubscribe();let e=await fetch("/api/chatSubscription",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversationId:t,user_agent_id:(0,u.getCookie)("user_agent_id")})}),n=await e.json();n.success?(r.invalidateQueries(["subscriptionStatus",(0,u.getCookie)("user_agent_id"),t]),console.log("Successfully unsubscribed!")):console.error("Error unsubscribing:",n.error)}}}catch(e){console.error("Push unsubscription failed:",e)}},[t,r]);return{requestNotificationPermission:l,unsubscribeFromNotifications:o}};let h=async(e,t)=>{let r=await fetch("/api/chatSubscription?user_agent_id=".concat(e,"&conversationId=").concat(t),{method:"GET"});return r.json()};var f=e=>{let{channelName:t}=e,r=(0,u.getCookie)("user_agent_id"),{requestNotificationPermission:n,unsubscribeFromNotifications:l}=p("/service-worker.js",t),{data:o,isLoading:a}=(0,d.a)(["subscriptionStatus",r,t],()=>h(r,t));if(a||!o)return(0,s.jsx)("button",{className:"rounded-lg bg-blue-200 px-1 text-sm",disabled:!0,children:"Verificando..."});let i=o.isSubscribed?l:n;return(0,s.jsx)("div",{children:(0,s.jsx)("button",{className:"rounded-lg bg-blue-200 px-1 text-sm",onClick:i,children:o.isSubscribed?"Desactivar Notificaciones":"Activar Notificaciones"})})},g=e=>{let{channelName:t}=e,r=(0,n.useContext)(o.SocketContext);if(!r)throw Error("You must use this component within a <ContextProvider>");let{setRoomName:i,usersInRoom:u}=r;return(0,n.useEffect)(()=>{i(t);let e=async()=>{try{let e=await fetch("/api/notifyUsers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({channelName:t})}),r=await e.json();r.success||console.error("Error notifying users:",r.error)}catch(e){console.error("Error notifying users:",e)}};e()},[t]),(0,s.jsxs)("div",{className:"flex flex-col justify-between h-full",children:[(0,s.jsxs)("div",{className:"border-2 w-full p-2 rounded-md shadow-md bg-gray-100 flex flex-col gap-2 items-left",children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Integrantes:"}),(0,s.jsx)("ul",{className:"flex gap-2 items-center",children:u.map((e,t)=>(0,s.jsx)("li",{className:"flex items-center",children:(0,s.jsx)("span",{className:"bg-blue-200 text-blue-800 rounded-full px-4 py-0.5 text-sm",children:e.name})},t))})]}),(0,s.jsxs)("div",{className:"w-fit",children:[(0,s.jsx)(a.Z,{title:"Unite al chat",url:"".concat("http://localhost:3000","/chat/").concat(encodeURI(t))}),(0,s.jsxs)("div",{className:" flex gap-2",children:[(0,s.jsx)(c(),{className:"rounded-lg bg-blue-200 px-1 text-sm",href:"/usuarios",children:"Volver"}),(0,s.jsx)(f,{channelName:t})]})]})]}),(0,s.jsx)(l.Z,{})]})},b=r(5152),x=r.n(b),v=r(1163);let j=x()(()=>Promise.resolve().then(r.bind(r,8119)).then(e=>e.ContextProvider),{loadableGenerated:{webpack:()=>[8119]},loading:()=>(0,s.jsx)("p",{className:"m-4 text-xl",children:"Cargando chat..."}),ssr:!1});var w=()=>{let e=(0,v.useRouter)(),t=e.query.id;return e.isReady?(0,s.jsx)("div",{className:"",children:(0,s.jsx)(j,{chatBoxVariant:"textchat",children:(0,s.jsx)(g,{channelName:t})})}):(0,s.jsx)("p",{className:"m-4 min-h-screen text-xl",children:"Registrando sala..."})}},5152:function(e,t,r){e.exports=r(5677)},6492:function(e,t,r){"use strict";r.d(t,{a:function(){return o}});var s=r(2161),n=r(2924),l=r(7187);function o(e,t,r){let o=(0,s._v)(e,t,r);return(0,l.r)(o,n.z)}}},function(e){e.O(0,[976,948,828,455,876,603,375,762,119,774,888,179],function(){return e(e.s=7189)}),_N_E=e.O()}]);